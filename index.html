<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CodeScanner - Universal QR & Barcode Scanner</title>
<style>
  :root{
    --bg-primary:#0a0e12;
    --bg-secondary:#0f1419;
    --bg-card:#141b22;
    --accent-primary:#00d9ff;
    --accent-secondary:#0091ff;
    --text-primary:#f8fafc;
    --text-secondary:#94a3b8;
    --text-muted:#64748b;
    --border-subtle:rgba(148,163,184,0.08);
    --shadow-lg:0 20px 50px rgba(0,0,0,0.5);
    --shadow-xl:0 25px 60px rgba(0,0,0,0.6);
    color-scheme:dark;
  }
  
  *{box-sizing:border-box}
  
  html,body{
    height:100%;
    margin:0;
    background:radial-gradient(ellipse at top, #0f1419 0%, #0a0e12 100%);
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Inter',sans-serif;
    color:var(--text-primary);
    line-height:1.6;
  }
  
  .container{
    max-width:1200px;
    margin:0 auto;
    padding:40px 24px;
  }
  
  .header-section{
    text-align:center;
    margin-bottom:48px;
    animation:fadeInDown 0.6s ease-out;
  }
  
  @keyframes fadeInDown{
    from{opacity:0;transform:translateY(-20px)}
    to{opacity:1;transform:translateY(0)}
  }
  
  .logo-wrapper{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:72px;
    height:72px;
    background:linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius:20px;
    margin-bottom:20px;
    box-shadow:0 8px 32px rgba(0,217,255,0.3);
  }
  
  .logo-icon{
    width:40px;
    height:40px;
    background:var(--bg-primary);
    border-radius:8px;
    position:relative;
  }
  
  .logo-icon::before,
  .logo-icon::after{
    content:'';
    position:absolute;
    background:var(--accent-primary);
  }
  
  .logo-icon::before{
    width:4px;
    height:24px;
    left:8px;
    top:8px;
  }
  
  .logo-icon::after{
    width:4px;
    height:16px;
    right:8px;
    top:12px;
  }
  
  h1{
    font-size:42px;
    font-weight:700;
    margin:0 0 12px;
    background:linear-gradient(135deg, var(--text-primary), var(--text-secondary));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    letter-spacing:-0.02em;
  }
  
  .subtitle{
    font-size:18px;
    color:var(--text-secondary);
    margin:0 0 8px;
    font-weight:400;
  }
  
  .author{
    font-size:14px;
    color:var(--text-muted);
    margin:0;
  }
  
  .author-link{
    color:var(--accent-primary);
    text-decoration:none;
    font-weight:500;
    transition:color 0.2s;
  }
  
  .author-link:hover{
    color:var(--accent-secondary);
  }
  
  .controls-panel{
    background:linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
    border:1px solid var(--border-subtle);
    border-radius:16px;
    padding:24px;
    margin-bottom:32px;
    box-shadow:var(--shadow-lg);
    animation:fadeIn 0.8s ease-out 0.2s both;
  }
  
  @keyframes fadeIn{
    from{opacity:0}
    to{opacity:1}
  }
  
  .controls-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:16px;
    align-items:end;
  }
  
  .control-group{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  
  .control-label{
    font-size:13px;
    font-weight:600;
    color:var(--text-secondary);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }
  
  select,input[type=file]{
    background:var(--bg-secondary);
    border:1px solid var(--border-subtle);
    color:var(--text-primary);
    padding:12px 14px;
    border-radius:10px;
    font-size:14px;
    cursor:pointer;
    transition:all 0.2s;
  }
  
  select:hover,input[type=file]:hover{
    border-color:var(--accent-primary);
  }
  
  select:focus,input[type=file]:focus{
    outline:none;
    border-color:var(--accent-primary);
    box-shadow:0 0 0 3px rgba(0,217,255,0.1);
  }
  
  .btn-group{
    display:flex;
    gap:12px;
  }
  
  button{
    background:linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border:none;
    color:var(--bg-primary);
    padding:12px 24px;
    border-radius:10px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    box-shadow:0 4px 16px rgba(0,217,255,0.3);
  }
  
  button:hover:not(:disabled){
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(0,217,255,0.4);
  }
  
  button:active:not(:disabled){
    transform:translateY(0);
  }
  
  button:disabled{
    opacity:0.5;
    cursor:not-allowed;
  }
  
  button.btn-stop{
    background:linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow:0 4px 16px rgba(239,68,68,0.3);
  }
  
  button.btn-stop:hover:not(:disabled){
    box-shadow:0 6px 20px rgba(239,68,68,0.4);
  }
  
  .main-grid{
    display:grid;
    grid-template-columns:1.5fr 1fr;
    gap:24px;
    animation:fadeIn 1s ease-out 0.4s both;
  }
  
  .panel{
    background:linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
    border:1px solid var(--border-subtle);
    border-radius:16px;
    padding:24px;
    box-shadow:var(--shadow-lg);
  }
  
  .panel-header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:16px;
    padding-bottom:16px;
    border-bottom:1px solid var(--border-subtle);
  }
  
  .panel-icon{
    width:32px;
    height:32px;
    background:linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
  }
  
  .panel-title{
    font-size:16px;
    font-weight:600;
    color:var(--text-primary);
    margin:0;
  }
  
  .video-wrapper{
    position:relative;
    border-radius:12px;
    overflow:hidden;
    background:#000;
    aspect-ratio:16/9;
    margin-bottom:16px;
  }
  
  video{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  
  canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    display:none;
    pointer-events:none;
  }
  
  .scan-indicator{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    width:200px;
    height:200px;
    border:3px solid var(--accent-primary);
    border-radius:16px;
    pointer-events:none;
    opacity:0.6;
  }
  
  .scan-indicator::before,
  .scan-indicator::after{
    content:'';
    position:absolute;
    background:var(--accent-primary);
  }
  
  .scan-indicator::before{
    top:-3px;
    left:-3px;
    right:-3px;
    height:3px;
    animation:scanLine 2s linear infinite;
  }
  
  @keyframes scanLine{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(200px)}
  }
  
  .info-text{
    font-size:13px;
    color:var(--text-muted);
    text-align:center;
    margin:0;
  }
  
  .result-section{
    margin-bottom:20px;
  }
  
  .result-label{
    font-size:12px;
    font-weight:600;
    color:var(--text-secondary);
    text-transform:uppercase;
    letter-spacing:0.5px;
    margin-bottom:8px;
    display:block;
  }
  
  .result-content{
    background:var(--bg-secondary);
    border:1px solid var(--border-subtle);
    border-radius:10px;
    padding:14px;
    font-family:'Fira Code',monospace;
    font-size:13px;
    color:var(--accent-primary);
    word-break:break-all;
    min-height:48px;
    display:flex;
    align-items:center;
  }
  
  .result-content.empty{
    color:var(--text-muted);
    justify-content:center;
  }
  
  .history-content{
    max-height:300px;
    overflow-y:auto;
    font-size:12px;
    line-height:1.8;
  }
  
  .history-content::-webkit-scrollbar{
    width:6px;
  }
  
  .history-content::-webkit-scrollbar-track{
    background:var(--bg-secondary);
    border-radius:3px;
  }
  
  .history-content::-webkit-scrollbar-thumb{
    background:var(--accent-primary);
    border-radius:3px;
  }
  
  .footer{
    margin-top:48px;
    padding-top:24px;
    border-top:1px solid var(--border-subtle);
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:13px;
    color:var(--text-muted);
    animation:fadeIn 1.2s ease-out 0.6s both;
  }
  
  .status-badge{
    padding:6px 12px;
    border-radius:20px;
    font-size:12px;
    font-weight:600;
  }
  
  .status-badge.error{
    background:rgba(239,68,68,0.1);
    color:#ef4444;
    border:1px solid rgba(239,68,68,0.2);
  }
  
  .status-badge.success{
    background:rgba(34,197,94,0.1);
    color:#22c55e;
    border:1px solid rgba(34,197,94,0.2);
  }
  
  @media (max-width: 968px){
    .main-grid{
      grid-template-columns:1fr;
    }
    
    h1{
      font-size:32px;
    }
    
    .controls-grid{
      grid-template-columns:1fr;
    }
  }
</style>
</head>
<body>
<div class="container">
  <header class="header-section">
    <div class="logo-wrapper">
      <div class="logo-icon"></div>
    </div>
    <h1>CodeScanner</h1>
    <p class="subtitle">Universal QR & Barcode Scanner with Camera Support</p>
    <p class="author">Developed by <a href="#" class="author-link">Surendra</a></p>
  </header>

  <div class="controls-panel">
    <div class="controls-grid">
      <div class="control-group">
        <label class="control-label">Camera Device</label>
        <select id="deviceSelect">
          <option>Loading cameras...</option>
        </select>
      </div>
      
      <div class="control-group">
        <label class="control-label">Upload Image</label>
        <input type="file" id="imgFile" accept="image/*"/>
      </div>
      
      <div class="control-group">
        <label class="control-label">Actions</label>
        <div class="btn-group">
          <button id="startBtn">Start Scanning</button>
          <button id="stopBtn" class="btn-stop" disabled>Stop</button>
        </div>
      </div>
    </div>
  </div>

  <div class="main-grid">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">ðŸ“·</div>
        <h2 class="panel-title">Live Camera Feed</h2>
      </div>
      
      <div class="video-wrapper">
        <video id="video" playsinline></video>
        <canvas id="overlay"></canvas>
        <div class="scan-indicator"></div>
      </div>
      
      <p class="info-text">Point your camera at a QR code or barcode. Allow camera access when prompted.</p>
    </div>

    <div class="panel">
      <div class="result-section">
        <span class="result-label">Decoded Content</span>
        <div id="result" class="result-content empty">No scan yet</div>
      </div>
      
      <div class="result-section">
        <span class="result-label">Barcode Format</span>
        <div id="format" class="result-content empty">â€”</div>
      </div>
      
      <div class="result-section">
        <span class="result-label">Scan History</span>
        <div id="history" class="result-content history-content empty">No history available</div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div>Â© 2025 Surendra. Works on mobile & desktop (HTTPS or localhost required)</div>
    <div id="status"></div>
  </footer>
</div>

<script src="https://unpkg.com/@zxing/library@0.18.6/umd/index.min.js"></script>
<script>
(async function(){
  const { BrowserMultiFormatReader, NotFoundException } = ZXing;
  const codeReader = new BrowserMultiFormatReader();
  const video = document.getElementById('video');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const deviceSelect = document.getElementById('deviceSelect');
  const resultEl = document.getElementById('result');
  const formatEl = document.getElementById('format');
  const historyEl = document.getElementById('history');
  const imgFile = document.getElementById('imgFile');
  const statusEl = document.getElementById('status');
  let selectedDeviceId = null;
  let decoding = false;
  let lastResults = [];

  function updateStatus(message, isError = false){
    if(!message){
      statusEl.textContent = '';
      statusEl.className = '';
      return;
    }
    statusEl.textContent = message;
    statusEl.className = isError ? 'status-badge error' : 'status-badge success';
  }

  function pushHistory(text, format){
    const time = new Date().toLocaleTimeString();
    lastResults.unshift(`[${time}] ${format} â†’ ${text}`);
    if(lastResults.length > 30) lastResults.pop();
    historyEl.textContent = lastResults.join('\n');
    historyEl.classList.remove('empty');
  }

  async function listDevices(){
    try{
      const devices = await BrowserMultiFormatReader.listVideoInputDevices();
      deviceSelect.innerHTML = '';
      
      if(devices.length === 0){
        deviceSelect.innerHTML = '<option>No cameras found</option>';
        updateStatus('No camera devices detected', true);
        return;
      }
      
      devices.forEach((d, i) => {
        const opt = document.createElement('option');
        opt.value = d.deviceId;
        opt.textContent = d.label || `Camera ${i + 1}`;
        deviceSelect.appendChild(opt);
      });
      
      selectedDeviceId = devices[0].deviceId;
      deviceSelect.value = selectedDeviceId;
    }catch(e){
      deviceSelect.innerHTML = '<option>Camera access denied</option>';
      updateStatus('Failed to access cameras', true);
    }
  }

  deviceSelect.addEventListener('change', () => {
    selectedDeviceId = deviceSelect.value;
  });

  async function startCamera(){
    if(decoding) return;
    decoding = true;
    startBtn.disabled = true;
    stopBtn.disabled = false;
    updateStatus('Scanning...', false);
    
    overlay.width = video.clientWidth;
    overlay.height = video.clientHeight;
    
    try{
      await codeReader.decodeFromVideoDevice(
        selectedDeviceId || undefined,
        'video',
        (result, err) => {
          if(result){
            const txt = result.getText();
            const fmt = result.getBarcodeFormat();
            resultEl.textContent = txt;
            resultEl.classList.remove('empty');
            formatEl.textContent = fmt;
            formatEl.classList.remove('empty');
            pushHistory(txt, fmt);
            flashOverlay();
            updateStatus('Code detected!', false);
          }else if(err && !(err instanceof NotFoundException)){
            console.error(err);
          }
        }
      );
    }catch(e){
      console.error(e);
      updateStatus('Camera failed: ' + (e.message || 'Unknown error'), true);
      decoding = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
    }
  }

  function stopCamera(){
    try{
      codeReader.reset();
    }catch(e){
      console.error(e);
    }
    decoding = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    updateStatus('');
  }

  function flashOverlay(){
    const ctx = overlay.getContext('2d');
    overlay.style.display = 'block';
    ctx.clearRect(0, 0, overlay.width, overlay.height);
    ctx.fillStyle = 'rgba(0, 217, 255, 0.15)';
    ctx.fillRect(0, 0, overlay.width, overlay.height);
    setTimeout(() => {
      ctx.clearRect(0, 0, overlay.width, overlay.height);
      overlay.style.display = 'none';
    }, 150);
  }

  imgFile.addEventListener('change', async (e) => {
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    
    updateStatus('Processing image...', false);
    
    const img = new Image();
    img.src = URL.createObjectURL(file);
    
    try{
      await img.decode();
      const canvas = document.createElement('canvas');
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      
      const luminanceSource = new ZXing.HTMLCanvasElementLuminanceSource(canvas);
      const binaryBitmap = new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));
      const reader = new ZXing.MultiFormatReader();
      const res = reader.decode(binaryBitmap);
      
      const txt = res.getText();
      const fmt = res.getBarcodeFormat();
      resultEl.textContent = txt;
      resultEl.classList.remove('empty');
      formatEl.textContent = fmt;
      formatEl.classList.remove('empty');
      pushHistory(txt, fmt);
      updateStatus('Image decoded successfully!', false);
    }catch(err){
      resultEl.textContent = 'No code found in image';
      resultEl.classList.add('empty');
      formatEl.textContent = 'â€”';
      formatEl.classList.add('empty');
      updateStatus('No barcode detected in image', true);
    }finally{
      URL.revokeObjectURL(img.src);
      imgFile.value = '';
    }
  });

  startBtn.addEventListener('click', startCamera);
  stopBtn.addEventListener('click', stopCamera);

  await listDevices();

  try{
    const permission = await navigator.permissions?.query?.({name: 'camera'});
    if(permission && permission.state === 'denied'){
      updateStatus('Camera permission denied in browser settings', true);
    }
  }catch(e){
    // Permissions API not supported, ignore
  }

  if(window.isSecureContext && deviceSelect.options.length === 1 && deviceSelect.options[0].value){
    selectedDeviceId = deviceSelect.value;
    setTimeout(startCamera, 500);
  }else if(!window.isSecureContext){
    updateStatus('HTTPS or localhost required for camera access', true);
  }
})();
</script>
</body>
</html>
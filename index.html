<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeScanner - Line UI</title>
<style>
  body {
    margin:0; padding:0;
    background:#000; color:#fff;
    font-family:'Segoe UI', sans-serif;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100vh;
    overflow:hidden;
  }
  h2 {
    text-align:center;
    font-weight:normal;
    letter-spacing:1px;
    text-shadow:0 0 5px #fff;
    margin-bottom:30px;
  }
  #reader {
    width:350px; max-width:90vw;
    border:2px solid #fff;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 0 15px #fff;
    margin-bottom:20px;
    position:relative;
  }
  #reader::before {
    content:"";
    position:absolute;
    top:0; left:0; right:0; bottom:0;
    border:2px dashed #fff; 
    border-radius:15px;
    pointer-events:none;
  }
  #result {
    width:350px; max-width:90vw;
    padding:10px 15px;
    text-align:center;
    font-size:1.1em;
    border:2px solid #fff;
    border-radius:10px;
    box-shadow:0 0 10px #fff inset;
    margin-bottom:20px;
  }
  button {
    padding:10px 25px;
    background:transparent;
    color:#fff;
    border:2px solid #fff;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    box-shadow:0 0 10px #fff;
    transition:0.2s;
  }
  button:hover {
    box-shadow:0 0 20px #fff;
  }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h2>CodeScanner</h2>
<div id="reader"></div>
<div id="result">Scan a QR or Barcode...</div>
<button id="toggleBtn">Start Scanner</button>

<script>
const readerDiv = document.getElementById("reader");
const resultDiv = document.getElementById("result");
const toggleBtn = document.getElementById("toggleBtn");

let scanning = false;
const html5QrCode = new Html5Qrcode("reader");

// Show pop-up that stays until user closes
function showPopup(message) {
  // overlay to dim background
  const overlay = document.createElement("div");
  overlay.style.position = "fixed";
  overlay.style.top = "0";
  overlay.style.left = "0";
  overlay.style.width = "100%";
  overlay.style.height = "100%";
  overlay.style.background = "rgba(0,0,0,0.5)";
  overlay.style.zIndex = "999";
  document.body.appendChild(overlay);

  const popup = document.createElement("div");
  popup.style.position = "fixed";
  popup.style.top = "50%";
  popup.style.left = "50%";
  popup.style.transform = "translate(-50%, -50%)";
  popup.style.padding = "15px 25px";
  popup.style.border = "2px solid #fff";
  popup.style.borderRadius = "10px";
  popup.style.color = "#fff";
  popup.style.fontSize = "1.1em";
  popup.style.textAlign = "center";
  popup.style.boxShadow = "0 0 15px #fff";
  popup.style.background = "transparent";
  popup.style.zIndex = "1000";

  const text = document.createElement("div");
  text.textContent = message;
  popup.appendChild(text);

  const closeBtn = document.createElement("button");
  closeBtn.textContent = "Close";
  closeBtn.style.marginTop = "10px";
  closeBtn.style.padding = "5px 15px";
  closeBtn.style.border = "2px solid #fff";
  closeBtn.style.background = "transparent";
  closeBtn.style.color = "#fff";
  closeBtn.style.cursor = "pointer";
  closeBtn.style.borderRadius = "5px";
  closeBtn.addEventListener("click", () => {
    popup.remove();
    overlay.remove();
  });
  popup.appendChild(closeBtn);

  document.body.appendChild(popup);
}

// Scan success callback
function onScanSuccess(qrCodeMessage) {
  resultDiv.textContent = "Scanned: " + qrCodeMessage;
  showPopup(qrCodeMessage);
  stopScanner(); // stop scanner after one scan
}

// Start scanner
function startScanner() {
  Html5Qrcode.getCameras().then(cameras => {
    if(cameras && cameras.length) {
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScanSuccess,
        errorMessage => {}
      ).then(() => {
        scanning = true;
        toggleBtn.textContent = "Stop Scanner";
      }).catch(err => console.error(err));
    }
  }).catch(err => console.error(err));
}

// Stop scanner
function stopScanner() {
  html5QrCode.stop().then(() => {
    scanning = false;
    toggleBtn.textContent = "Start Scanner";
    resultDiv.textContent = "Scanner stopped";
    readerDiv.innerHTML = ""; // release camera
  }).catch(err => console.error(err));
}

// Toggle button
toggleBtn.addEventListener("click", () => {
  scanning ? stopScanner() : startScanner();
});
</script>

</body>
</html>

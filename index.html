<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeScanner Tabs</title>
<style>
  body {
    margin:0; padding:20px;
    background:#000; color:#fff;
    font-family:'Segoe UI', sans-serif;
    display:flex; flex-direction:column; align-items:center;
    min-height:100vh;
  }
  h2 { text-align:center; margin-bottom:20px; }
  .tab-buttons {
    display:flex;
    margin-bottom:20px;
  }
  .tab-buttons button {
    padding:10px 20px;
    border:2px solid #fff;
    background:transparent;
    color:#fff;
    cursor:pointer;
    font-weight:bold;
    margin-left:-2px; /* to merge borders */
    transition:0.2s;
  }
  .tab-buttons button:first-child { border-radius:10px 0 0 10px; margin-left:0; }
  .tab-buttons button:last-child { border-radius:0 10px 10px 0; }
  .tab-buttons button.active {
    background:#fff;
    color:#000;
  }
  #reader {
    width:360px; max-width:90vw;
    border:2px solid #fff;
    border-radius:12px;
    box-shadow:0 0 10px #fff;
    overflow:hidden;
  }
  #result {
    width:360px; max-width:90vw;
    margin-top:20px;
    padding:10px 15px;
    border:2px solid #fff;
    border-radius:10px;
    text-align:center;
    font-size:1.1em;
    box-shadow: inset 0 0 10px #fff;
    background:#000;
    word-break: break-word;
  }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h2>CodeScanner</h2>

<div class="tab-buttons">
  <button id="qrTab" class="active">QR Code</button>
  <button id="barcodeTab">Barcode</button>
</div>

<div id="reader"></div>
<div id="result">Scanning QR Code...</div>

<script>
const readerDiv = document.getElementById("reader");
const resultDiv = document.getElementById("result");
const qrTab = document.getElementById("qrTab");
const barcodeTab = document.getElementById("barcodeTab");

let html5QrCode;
let currentCameraId;
let scanningMode = "qr"; // "qr" or "barcode"

// Start scanner function
function startScanner(cameraId, mode) {
  if(html5QrCode) {
    html5QrCode.stop().catch(()=>{}); // stop previous camera
  }
  html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { deviceId: { exact: cameraId } },
    { fps: 10, qrbox: 250, formatsToSupport: mode==="barcode"?[Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.CODE_39, Html5QrcodeSupportedFormats.EAN_13]:[Html5QrcodeSupportedFormats.QR_CODE] },
    qrCodeMessage => { 
      resultDiv.textContent = (mode==="barcode"?"Scanned Barcode: ":"Scanned QR: ") + qrCodeMessage; 
    },
    errorMessage => { /* ignore minor errors */ }
  ).catch(err => resultDiv.textContent = "Camera error: " + err);
}

// Populate cameras
Html5Qrcode.getCameras().then(cameras => {
  if(cameras && cameras.length) {
    currentCameraId = cameras[0].id;
    startScanner(currentCameraId, scanningMode);
  } else {
    resultDiv.textContent = "No cameras found.";
  }
}).catch(err => resultDiv.textContent = "Camera access error: " + err);

// Tab switching
qrTab.addEventListener("click", ()=>{
  scanningMode="qr";
  qrTab.classList.add("active");
  barcodeTab.classList.remove("active");
  resultDiv.textContent = "Scanning QR Code...";
  startScanner(currentCameraId, scanningMode);
});

barcodeTab.addEventListener("click", ()=>{
  scanningMode="barcode";
  barcodeTab.classList.add("active");
  qrTab.classList.remove("active");
  resultDiv.textContent = "Scanning Barcode...";
  startScanner(currentCameraId, scanningMode);
});
</script>

</body>
</html>

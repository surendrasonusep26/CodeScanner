<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeScanner with Zoom</title>
<style>
  body {
    margin:0; padding:20px;
    background:#000; color:#fff;
    font-family:'Segoe UI', sans-serif;
    display:flex; flex-direction:column; align-items:center;
    min-height:100vh;
  }
  h2 { text-align:center; margin-bottom:20px; }
  #cameraSelect {
    margin-bottom:15px;
    padding:8px 12px;
    border:2px solid #fff;
    border-radius:10px;
    background:#000;
    color:#fff;
    cursor:pointer;
    width:90%;
    max-width:360px;
  }
  .tab-buttons {
    display:flex;
    flex-wrap:wrap;
    width:90%;
    max-width:360px;
    margin-bottom:20px;
  }
  .tab-buttons button {
    flex:1;
    padding:10px;
    border:2px solid #fff;
    background:transparent;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
    transition:0.2s;
    margin-left:-2px;
    margin-top:5px;
  }
  .tab-buttons button:first-child { border-radius:10px 0 0 10px; margin-left:0; }
  .tab-buttons button:last-child { border-radius:0 10px 10px 0; }
  .tab-buttons button.active { background:#fff; color:#000; }
  #reader {
    width:90%;
    max-width:360px;
    border:2px solid #fff;
    border-radius:12px;
    box-shadow:0 0 10px #fff;
    overflow:hidden;
    position:relative;
  }
  #result {
    width:90%;
    max-width:360px;
    margin-top:20px;
    padding:10px 15px;
    border:2px solid #fff;
    border-radius:10px;
    text-align:center;
    font-size:1.1em;
    box-shadow: inset 0 0 10px #fff;
    background:#000;
    word-break: break-word;
  }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h2>CodeScanner</h2>

<select id="cameraSelect"></select>
<div class="tab-buttons">
  <button id="qrTab" class="active">QR Code</button>
  <button id="barcodeTab">Barcode</button>
</div>

<div id="reader"></div>
<div id="result">Scanning QR Code...</div>

<script>
const readerDiv = document.getElementById("reader");
const resultDiv = document.getElementById("result");
const cameraSelect = document.getElementById("cameraSelect");
const qrTab = document.getElementById("qrTab");
const barcodeTab = document.getElementById("barcodeTab");

let html5QrCode;
let currentCameraId;
let scanningMode = "qr";
let videoTrack;
let zoomValue = 1;
let zoomDirection = 1;

// Apply automatic zoom in/out
function startZoomAnimation() {
  if(!videoTrack || !videoTrack.getCapabilities().zoom) return;
  const capabilities = videoTrack.getCapabilities();
  const minZoom = capabilities.zoom.min || 1;
  const maxZoom = capabilities.zoom.max || 3;

  function animateZoom() {
    zoomValue += 0.02 * zoomDirection;
    if(zoomValue >= maxZoom) zoomDirection = -1;
    if(zoomValue <= minZoom) zoomDirection = 1;
    videoTrack.applyConstraints({ advanced: [{ zoom: zoomValue }] }).catch(()=>{});
    requestAnimationFrame(animateZoom);
  }
  animateZoom();
}

// Start scanner
function startScanner(cameraId, mode) {
  if(html5QrCode) {
    html5QrCode.stop().catch(()=>{});
  }
  html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { deviceId: { exact: cameraId } },
    { 
      fps: 10, 
      qrbox: 250, 
      formatsToSupport: mode==="barcode"?[
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.CODE_39,
        Html5QrcodeSupportedFormats.EAN_13
      ]:[
        Html5QrcodeSupportedFormats.QR_CODE
      ]
    },
    qrCodeMessage => { 
      resultDiv.textContent = (mode==="barcode"?"Scanned Barcode: ":"Scanned QR: ") + qrCodeMessage; 
    },
    errorMessage => {}
  ).then(() => {
    // Access video track for zoom
    const videoElem = readerDiv.querySelector("video");
    if(videoElem && videoElem.srcObject) {
      videoTrack = videoElem.srcObject.getVideoTracks()[0];
      startZoomAnimation();
    }
  }).catch(err => resultDiv.textContent = "Camera error: " + err);
}

// Populate cameras
Html5Qrcode.getCameras().then(cameras => {
  if(cameras && cameras.length) {
    cameras.forEach(cam => {
      const option = document.createElement("option");
      option.value = cam.id;
      option.textContent = cam.label || cam.id;
      cameraSelect.appendChild(option);
    });
    currentCameraId = cameras[0].id;
    cameraSelect.value = currentCameraId;
    startScanner(currentCameraId, scanningMode);
  } else {
    resultDiv.textContent = "No cameras found.";
  }
}).catch(err => resultDiv.textContent = "Camera access error: " + err);

// Switch camera
cameraSelect.addEventListener("change", () => {
  currentCameraId = cameraSelect.value;
  startScanner(currentCameraId, scanningMode);
});

// Tab switching
qrTab.addEventListener("click", ()=>{
  scanningMode="qr";
  qrTab.classList.add("active");
  barcodeTab.classList.remove("active");
  resultDiv.textContent = "Scanning QR Code...";
  startScanner(currentCameraId, scanningMode);
});
barcodeTab.addEventListener("click", ()=>{
  scanningMode="barcode";
  barcodeTab.classList.add("active");
  qrTab.classList.remove("active");
  resultDiv.textContent = "Scanning Barcode...";
  startScanner(currentCameraId, scanningMode);
});
</script>

</body>
</html>

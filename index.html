<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeScanner</title>
<style>
  body {
    margin:0; padding:20px;
    background:#000; color:#fff;
    font-family:'Segoe UI', sans-serif;
    display:flex; flex-direction:column; align-items:center;
    justify-content:flex-start;
    min-height:100vh;
  }
  h2 {
    text-align:center;
    font-weight:normal;
    letter-spacing:1px;
    text-shadow:0 0 5px #fff;
    margin-bottom:20px;
  }
  #cameraSelect {
    margin-bottom:20px;
    padding:5px 10px;
    border:2px solid #fff;
    border-radius:10px;
    background:#000;
    color:#fff;
    cursor:pointer;
  }
  #reader {
    width:360px; max-width:90vw;
    border:2px solid #fff;
    border-radius:12px;
    box-shadow:0 0 10px #fff;
    overflow:hidden;
  }
  #result {
    width:360px; max-width:90vw;
    margin-top:20px;
    padding:10px 15px;
    border:2px solid #fff;
    border-radius:10px;
    text-align:center;
    font-size:1.1em;
    box-shadow: inset 0 0 10px #fff;
    background:#000;
    word-break: break-word;
  }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h2>CodeScanner</h2>
<select id="cameraSelect"></select>
<div id="reader"></div>
<div id="result">Scanning...</div>

<script>
const readerDiv = document.getElementById("reader");
const resultDiv = document.getElementById("result");
const cameraSelect = document.getElementById("cameraSelect");

let html5QrCode;
let currentCameraId;

// Populate camera selection and start scanner
Html5Qrcode.getCameras().then(cameras => {
  if(cameras && cameras.length) {
    cameras.forEach(cam => {
      const option = document.createElement("option");
      option.value = cam.id;
      option.textContent = cam.label || cam.id;
      cameraSelect.appendChild(option);
    });
    currentCameraId = cameras[0].id;
    cameraSelect.value = currentCameraId;
    startScanner(currentCameraId);
  } else {
    resultDiv.textContent = "No cameras found.";
  }
}).catch(err => {
  resultDiv.textContent = "Error accessing cameras: " + err;
});

// Start scanner function
function startScanner(cameraId) {
  if(html5QrCode) {
    html5QrCode.stop().catch(()=>{}); // stop previous camera
  }
  html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { deviceId: { exact: cameraId } },
    { fps: 10, qrbox: 250 },
    qrCodeMessage => { resultDiv.textContent = "Scanned: " + qrCodeMessage; },
    errorMessage => { /* ignore minor errors */ }
  ).catch(err => resultDiv.textContent = "Camera error: " + err);
}

// Switch camera when user selects a different device
cameraSelect.addEventListener("change", () => {
  currentCameraId = cameraSelect.value;
  startScanner(currentCameraId);
});
</script>

</body>
</html>
